# First-Wasm

è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ wasm ç¨‹åºï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¼–è¯‘å‡º wasm æ–‡ä»¶ï¼š

```bash
wasm-pack build --target web # ç¼–è¯‘å‡ºå®Œæ•´çš„ wasm åŒ…è£…å’Œä»£ç 
cargo build --target wasm32-unknown-unknown # ç¼–è¯‘å‡ºå• wasm
```

è¿™ä¸¤ä¸ªå‘½ä»¤è™½ç„¶éƒ½æ˜¯ç”¨æ¥æ„å»º WebAssemblyï¼Œä½†æœ‰å‡ ä¸ªé‡è¦çš„åŒºåˆ«ï¼š

`wasm-pack build --target web`:

1. ç”Ÿæˆå®Œæ•´çš„ JavaScript ç»‘å®šå’ŒåŒ…è£…ä»£ç ï¼Œä½¿ WASM æ¨¡å—æ›´å®¹æ˜“åœ¨ web ç¯å¢ƒä¸­ä½¿ç”¨
2. è‡ªåŠ¨ç”Ÿæˆ TypeScript ç±»å‹å®šä¹‰æ–‡ä»¶ (.d.ts)
3. åˆ›å»ºä¸€ä¸ª npm åŒ…ç»“æ„ï¼ŒåŒ…å«:
   - package.json
   - JavaScript èƒ¶æ°´ä»£ç 
   - .wasm æ–‡ä»¶
   - TypeScript å®šä¹‰
4. ä½¿ç”¨ wasm-bindgen å¤„ç†å¯¼å‡ºçš„å‡½æ•°ï¼Œä½¿å…¶æ›´å®¹æ˜“ä¸ JavaScript äº¤äº’

`cargo build --target wasm32-unknown-unknown`:

1. åªç”ŸæˆåŸå§‹çš„ .wasm æ–‡ä»¶ï¼Œæ²¡æœ‰ä»»ä½• JavaScript ç»‘å®š
2. ä¸ç”Ÿæˆä»»ä½•é¢å¤–çš„åŒ…è£…ä»£ç æˆ–ç±»å‹å®šä¹‰
3. è¾“å‡ºæ˜¯ä¸€ä¸ªè£¸çš„ WebAssembly æ¨¡å—
4. éœ€è¦æ‰‹åŠ¨ç¼–å†™ JavaScript ä»£ç æ¥åŠ è½½å’Œä½¿ç”¨è¿™ä¸ª WASM æ¨¡å—
5. æ›´é€‚åˆåº•å±‚æˆ–è‡ªå®šä¹‰çš„ WASM ä½¿ç”¨åœºæ™¯

ä½¿ç”¨å»ºè®®ï¼š
- å¦‚æœä½ åœ¨å¼€å‘é¢å‘ Web çš„é¡¹ç›®ï¼Œå»ºè®®ä½¿ç”¨ `wasm-pack build --target web`ï¼Œå› ä¸ºå®ƒæä¾›äº†æ›´å®Œæ•´çš„å·¥å…·é“¾æ”¯æŒ
- å¦‚æœä½ éœ€è¦æ›´åº•å±‚çš„æ§åˆ¶ï¼Œæˆ–è€…åœ¨é Web ç¯å¢ƒä¸­ä½¿ç”¨ WASMï¼Œå¯ä»¥ä½¿ç”¨ `cargo build --target wasm32-unknown-unknown`

# ä½¿ç”¨

è®©æˆ‘è¯¦ç»†è§£é‡Šä¸€ä¸‹ wasm-pack çš„è¿™äº›å‘½ä»¤å’Œä½ å±•ç¤ºçš„é¡¹ç›®ç»“æ„ï¼š

ä¸»è¦å‘½ä»¤è§£é‡Šï¼š

1. `wasm-pack build` - ğŸ—ï¸ æ„å»º npm åŒ…
   - å°†ä½ çš„ Rust ä»£ç ç¼–è¯‘æˆ WebAssembly
   - ç”Ÿæˆç›¸åº”çš„ JavaScript åŒ…è£…ä»£ç 
   - åˆ›å»ºä¸€ä¸ªå¯ä»¥å‘å¸ƒåˆ° npm çš„åŒ…

2. `wasm-pack pack` - ğŸ± æ‰“åŒ…ä½†ä¸å‘å¸ƒ
   - å°†ç¼–è¯‘å¥½çš„ WebAssembly æ¨¡å—æ‰“åŒ…æˆ tar æ–‡ä»¶
   - é€‚åˆåœ¨å‘å¸ƒå‰æ£€æŸ¥æ‰“åŒ…å†…å®¹

3. `wasm-pack new` - ğŸ‘ åˆ›å»ºæ–°é¡¹ç›®
   - ä½¿ç”¨æ¨¡æ¿åˆ›å»ºä¸€ä¸ªæ–°çš„ WebAssembly é¡¹ç›®
   - è‡ªåŠ¨è®¾ç½®åŸºæœ¬çš„é¡¹ç›®ç»“æ„

4. `wasm-pack publish` - ğŸ† å‘å¸ƒåˆ° npm
   - å°†åŒ…å‘å¸ƒåˆ° npm ä»“åº“
   - ä½¿å…¶ä»–å¼€å‘è€…å¯ä»¥ä½¿ç”¨ä½ çš„ WebAssembly æ¨¡å—

5. `wasm-pack login` - ğŸ‘¤ npm ç”¨æˆ·ç™»å½•
   - æ·»åŠ  npm æ³¨å†Œè¡¨ç”¨æˆ·è´¦æˆ·
   - ç”¨äºå‘å¸ƒå‰çš„è®¤è¯

6. `wasm-pack test` - ğŸ‘©â€ğŸ”¬ æµ‹è¯•
   - è¿è¡Œ WebAssembly ç›¸å…³çš„æµ‹è¯•

ä½ å½“å‰çš„é¡¹ç›®ç»“æ„ï¼š
```
.
â”œâ”€â”€ Cargo.lock      # Rust ä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ Cargo.toml      # Rust é¡¹ç›®é…ç½®å’Œä¾èµ–å£°æ˜
â”œâ”€â”€ README.md       # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â””â”€â”€ src
    â””â”€â”€ lib.rs      # Rust æºä»£ç æ–‡ä»¶ï¼Œå°†è¢«ç¼–è¯‘ä¸º WebAssembly
```

è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ Rust WebAssembly é¡¹ç›®ç»“æ„ã€‚ä½¿ç”¨ wasm-pack ç¼–è¯‘åï¼Œä¼šç”Ÿæˆé¢å¤–çš„æ–‡ä»¶å¤¹ï¼ˆé€šå¸¸æ˜¯ `pkg/`ï¼‰ï¼Œå…¶ä¸­åŒ…å«ç¼–è¯‘å¥½çš„ WebAssembly æ–‡ä»¶å’Œç›¸åº”çš„ JavaScript èƒ¶æ°´ä»£ç ã€‚

å¦‚æœä½ æƒ³å¼€å§‹æ„å»ºï¼Œé€šå¸¸çš„æ­¥éª¤æ˜¯ï¼š
1. åœ¨ lib.rs ä¸­ç¼–å†™ Rust ä»£ç 
2. ä½¿ç”¨ `wasm-pack build` ç¼–è¯‘é¡¹ç›®
3. æµ‹è¯•ç”Ÿæˆçš„ WebAssembly æ¨¡å—
4. éœ€è¦æ—¶å‘å¸ƒåˆ° npm

# æµ‹è¯•

è¿è¡Œ `wasm-pack test --chrome` è¿™ä¸ªå‘½ä»¤ä¼šï¼š

ç¼–è¯‘ä½ çš„ Rust ä»£ç ä¸º WebAssembly
åœ¨ Chrome æµè§ˆå™¨ä¸­è¿è¡Œæµ‹è¯•
æŠ¥å‘Šæµ‹è¯•ç»“æœ

å¦‚æœä½ æƒ³åœ¨å…¶ä»–æµè§ˆå™¨ä¸­æµ‹è¯•ï¼Œwasm-pack ä¹Ÿæ”¯æŒ Firefox (`--firefox`) å’Œæ— å¤´æµè§ˆå™¨ (`--headless`)ã€‚
